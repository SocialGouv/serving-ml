// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`kosko generate --dev 1`] = `
"---
metadata:
  annotations:
    field.cattle.io/creatorId: gitlab
    field.cattle.io/projectId: 'c-bd7z2:p-wcxt4'
    git/branch: master
    git/remote: >-
      https://gitlab-ci-token:[MASKED]@gitlab.factory.social.gouv.fr/SocialGouv/serving-ml.git
    app.gitlab.com/app: socialgouv-serving-ml
    app.gitlab.com/env: master-dev2
    app.gitlab.com/env.name: master-dev2
  labels:
    azure-pg-admin-user: serving-ml
    application: master-dev2-serving-ml
    owner: serving-ml
    team: serving-ml
    cert: wildcard
  name: serving-ml-144-master-dev2
apiVersion: v1
kind: Namespace
---
metadata:
  annotations:
    app.gitlab.com/app: socialgouv-serving-ml
    app.gitlab.com/env: master-dev2
    app.gitlab.com/env.name: master-dev2
  labels:
    app: api
    application: master-dev2-serving-ml
    owner: serving-ml
    team: serving-ml
    cert: wildcard
  name: api
  namespace: serving-ml-144-master-dev2
spec:
  replicas: 1
  selector:
    matchLabels:
      app: api
  template:
    metadata:
      annotations:
        app.gitlab.com/app: socialgouv-serving-ml
        app.gitlab.com/env: master-dev2
        app.gitlab.com/env.name: master-dev2
      labels:
        app: api
        application: master-dev2-serving-ml
        owner: serving-ml
        team: serving-ml
        cert: wildcard
    spec:
      containers:
        - image: >-
            registry.gitlab.factory.social.gouv.fr/socialgouv/serving-ml/api:0123456789abcdefghijklmnopqrstuvwxyz0123
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /v1/models/sentqam
              port: http
            initialDelaySeconds: 15
            periodSeconds: 5
            timeoutSeconds: 15
          name: api
          ports:
            - containerPort: 8501
              name: http
          readinessProbe:
            failureThreshold: 15
            httpGet:
              path: /v1/models/sentqam
              port: http
            initialDelaySeconds: 5
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 3
          resources:
            limits:
              cpu: 1000m
              memory: 2Gi
            requests:
              cpu: 500m
              memory: 1.5Gi
          startupProbe:
            failureThreshold: 12
            httpGet:
              path: /v1/models/sentqam
              port: http
            periodSeconds: 5
            initialDelaySeconds: 0
            timeoutSeconds: 15
apiVersion: apps/v1
kind: Deployment
---
metadata:
  labels:
    app: api
    application: master-dev2-serving-ml
    owner: serving-ml
    team: serving-ml
    cert: wildcard
  name: api
  annotations:
    app.gitlab.com/app: socialgouv-serving-ml
    app.gitlab.com/env: master-dev2
    app.gitlab.com/env.name: master-dev2
  namespace: serving-ml-144-master-dev2
spec:
  ports:
    - name: http
      port: 80
      targetPort: 8501
  selector:
    app: api
  type: ClusterIP
apiVersion: v1
kind: Service
---
metadata:
  annotations:
    app.gitlab.com/app: socialgouv-serving-ml
    app.gitlab.com/env: master-dev2
    app.gitlab.com/env.name: master-dev2
  labels:
    app: cache
    application: master-dev2-serving-ml
    owner: serving-ml
    team: serving-ml
    cert: wildcard
  name: cache
  namespace: serving-ml-144-master-dev2
spec:
  replicas: 1
  selector:
    matchLabels:
      app: cache
  template:
    metadata:
      annotations:
        app.gitlab.com/app: socialgouv-serving-ml
        app.gitlab.com/env: master-dev2
        app.gitlab.com/env.name: master-dev2
      labels:
        app: cache
        application: master-dev2-serving-ml
        owner: serving-ml
        team: serving-ml
        cert: wildcard
    spec:
      containers:
        - image: 'nginx:1.19.6'
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /v1/models/sentqam
              port: http
            initialDelaySeconds: 15
            periodSeconds: 5
            timeoutSeconds: 15
          name: cache
          ports:
            - containerPort: 80
              name: http
          readinessProbe:
            failureThreshold: 15
            httpGet:
              path: /v1/models/sentqam
              port: http
            initialDelaySeconds: 5
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 3
          resources:
            limits:
              cpu: 1000m
              memory: 1Gi
            requests:
              cpu: 100m
              memory: 0.5Gi
          startupProbe:
            failureThreshold: 12
            httpGet:
              path: /v1/models/sentqam
              port: http
            periodSeconds: 5
            initialDelaySeconds: 0
            timeoutSeconds: 15
          env:
            - name: UPSTREAM
              value: 'http://api'
            - name: MAX_SIZE
              value: 1024m
          volumeMounts:
            - mountPath: /var/cache/nginx
              name: cache
            - mountPath: /etc/nginx/nginx.conf
              subPath: nginx.conf
              name: config
          envFrom:
            - secretRef:
                name: cache-sealed-secret
      volumes:
        - name: cache
          azureFile:
            secretName: cache-sealed-secret
            shareName: http-cache
            readOnly: false
        - name: config
          configMap:
            name: nginx-config
apiVersion: apps/v1
kind: Deployment
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  annotations:
    sealedsecrets.bitnami.com/cluster-wide: 'true'
    app.gitlab.com/app: socialgouv-serving-ml
    app.gitlab.com/env: master-dev2
    app.gitlab.com/env.name: master-dev2
  name: cache-sealed-secret
  labels:
    application: master-dev2-serving-ml
    owner: serving-ml
    team: serving-ml
    cert: wildcard
  namespace: serving-ml-144-master-dev2
spec:
  encryptedData:
    azurestorageaccountname: >-
      AgCULAfTVwvi/z3xFFunx4CslhK29xPKxzvQL+nnVwQzz8jLXtNubaVnEaVcBbU6DGlfkIocbsU/bDheZ25pWuOpDtoQC7lcTa9VTX8956V9fzW1MCx6Ob8uwoxZ7Ge63IdWkX7gACtax/riEy+Kg/hlufzo/4cqZV1M2EjLoHZTnsDZ4os6pNsdNxMtEcNA/v0qOwgAkA6Fj7cn9njsR3FgIbTYWf4Hs0DH8TQdUqfJOEgE+PheuL6yJircIsxRZKRUV9zFuxFozm+aBuLHfqwI9pHGvcfZ9pfGk38H0sLX9kJpk41C4PIV0OJu28j0tozrNgYPwLaJGMRsu4Up00keSbPxaOFrhQGCtPeE0b4lsBHhWXFv4IGPiVMk6f2xWRNQ5z9PQq3YsH9ZNtiZMPxYAoQHJRWwqLbaSLpHjHDMbUlqef/LDZ8KbtF3n4omXHAOTbcvrGcYXCiyrAqZxw3jKtPRztKFkNzcPDYEWdRXfOCRJp0N5p6csyhwD06dwSxGcv5L5umm8/E4Jl/LOx9PtBZC0u0dLykAYwkD8qw9rHShQa2SXxgG+4D2oGndbjXq+M0CuqwapLLYA1MmY+A+uW+H/krHvNyBKTGF2QhAMeoLAY6bdQnwDoq1EyQ6ZB5ic/N6UpPd5uhTtL24LLLnNRXEWttR8nmanYW7Ca9BE3tJZQscduCvIYbid+Qecd0KGx7OcAlcxsUbccePrRa4
    azurestorageaccountkey: >-
      AgCI+qNmU2NrmRaL1wXN0tLKThEdlDDWtHp5/wHIwO1JkZR9/FmXlcFZSPeR4O4FPd7FDoJXl1FHwKUYNu4xNa7HC9fS/3TDeRTiV/a7dzbLa8C0MTSySLxuEhqwFC2TWc6T6z0FF+5XmS9Hu9kXL6wM5ZFCAf74DGtLGZdOlE2IXXhK8Ht7a6S/1aHjLs5UBegpTpeiDAawON46XzlAJEH6JMUkHIsNP6qJ00nV74+kTj+d9qSNvNx+wxcI3jxz2AsC+NuiUfk7wfJz0u8tLA+n1agkVXomREzqXOIHVbYPK8SQCD+oxQjUlFeSdJPrJzi6PSlfk2sFL4+V829E+Az1coLOkOgmOEvjnsyFGPbUNcvJofoGXeRZodAdbWjeOZwnkoZYTwZGxBnaLbjAO+igY/Wuq5faar+TBWirREkeHMaGFEpWZmqIM6U+Bej1Oy6Duqz9Qmo7wUeV4RHAUJD+nTM7AEN1pcyYiezR1iBK6lLo9N+UH7X8zFa3BkdFEOE0RpnLzK0C7BiDvfnF0XUh+dcoJJMhAgMSXthI2r5LWBtk7ypM0EXZefpAyBK2QZKfZSIq0fHsSxUnFyYC4bBK6S8Gh11tYt9Z8hm8NsV3CbntlDX6+MNw7bAaq1GFpXp5XuyRrkKP0h4tTN/SxqAWXfiurcYPWMYdcOf2b6IGc+LqI807fZj1+WShFr5HirPoIH8Roz9Kajs6xNkgNcjwKtrTIVk0oxAKucSgouie7eo/jS/lP78qkhje9XXEXbUEmy4ryQWDkyZ6TuYZLXc7bppqZsHXiWkLl/gK4Z32ZAYn93hL0JMl
  template:
    metadata:
      annotations:
        sealedsecrets.bitnami.com/cluster-wide: 'true'
        app.gitlab.com/app: socialgouv-serving-ml
        app.gitlab.com/env: master-dev2
        app.gitlab.com/env.name: master-dev2
      name: cache-sealed-secret
      labels:
        application: master-dev2-serving-ml
        owner: serving-ml
        team: serving-ml
        cert: wildcard
    type: Opaque
---
metadata:
  labels:
    app: cache
    application: master-dev2-serving-ml
    owner: serving-ml
    team: serving-ml
    cert: wildcard
  name: cache
  annotations:
    app.gitlab.com/app: socialgouv-serving-ml
    app.gitlab.com/env: master-dev2
    app.gitlab.com/env.name: master-dev2
  namespace: serving-ml-144-master-dev2
spec:
  ports:
    - name: http
      port: 80
      targetPort: 80
  selector:
    app: cache
  type: ClusterIP
apiVersion: v1
kind: Service
---
metadata:
  annotations:
    kubernetes.io/ingress.class: nginx
    app.gitlab.com/app: socialgouv-serving-ml
    app.gitlab.com/env: master-dev2
    app.gitlab.com/env.name: master-dev2
  labels:
    app: cache
    application: master-dev2-serving-ml
    owner: serving-ml
    team: serving-ml
    cert: wildcard
  name: cache
  namespace: serving-ml-144-master-dev2
spec:
  rules:
    - host: master-dev2-serving-ml.dev2.fabrique.social.gouv.fr
      http:
        paths:
          - backend:
              serviceName: cache
              servicePort: 80
            path: /
  tls:
    - hosts:
        - master-dev2-serving-ml.dev2.fabrique.social.gouv.fr
      secretName: wildcard-crt
apiVersion: extensions/v1beta1
kind: Ingress
---
metadata:
  name: nginx-config
data:
  nginx.conf: |

    events {
     worker_connections 1024;
    }

    http {
     include mime.types;
     default_type application/octet-stream;
     sendfile on;
     keepalive_timeout 65;
     client_max_body_size 200k;

     proxy_buffering on;
     proxy_cache_path /cache levels=1:2 keys_zone=small:1m inactive=1w use_temp_path=off;

     server {
      listen 80;
      server_name localhost;

      location / {
       try_files $uri @backend;
      }

      location @backend {
       proxy_cache small;
       proxy_cache_methods POST;
       proxy_pass http://api:80;
       proxy_cache_key \\"$request_uri|$request_body\\";
       proxy_cache_valid any 1w;
       proxy_buffers 8 32k;
       proxy_buffer_size 64k;
       proxy_cache_use_stale updating;
       add_header X-Cached $upstream_cache_status;
      }
     }

    }
apiVersion: v1
kind: ConfigMap
"
`;
